{
  "scenario_1_basic": {
    "name": "Basic Needle - Coinbase Maturity",
    "difficulty": "easy",
    "prompt": "In the Bitcoin codebase, find where the coinbase transaction maturity check (100 blocks) is implemented. Show me the constant definition and where it's actually used in validation.",
    "expected_files": ["src/consensus/consensus.h", "src/validation.cpp"],
    "expected_concepts": ["COINBASE_MATURITY", "IsCoinBase", "spend"],
    "success_criteria": "Found constant and at least one usage site"
  },

  "scenario_2_semantic": {
    "name": "Semantic Understanding - Block Weight",
    "difficulty": "medium",
    "prompt": "Where does the Bitcoin code handle the case when a block's transactions would exceed the maximum block weight? I want to understand the validation logic that rejects blocks that are too heavy.",
    "expected_files": ["src/validation.cpp", "src/consensus/validation.h"],
    "expected_concepts": ["GetBlockWeight", "MAX_BLOCK_WEIGHT", "block validation"],
    "success_criteria": "Found weight calculation and validation rejection logic"
  },

  "scenario_3_multihop": {
    "name": "Multi-hop Reasoning - Fee Priority",
    "difficulty": "hard",
    "prompt": "Trace how a transaction's fee rate affects its priority in block template construction. Show me the path from how fees are tracked in the mempool, through the mining algorithm that selects transactions, to where GetBlockTemplate RPC returns the ordered list.",
    "expected_files": ["src/txmempool.cpp", "src/node/miner.cpp", "src/rpc/mining.cpp"],
    "expected_concepts": ["CTxMemPoolEntry", "BlockAssembler", "getblocktemplate"],
    "success_criteria": "Traced flow across all three components with correct function names"
  },

  "scenario_4_deep": {
    "name": "Deep Architecture - Signature Caching",
    "difficulty": "very_hard",
    "prompt": "Find all places where signature validation can be skipped due to caching, and explain how the cache gets invalidated during blockchain reorganizations. I need to understand the full caching architecture for script verification.",
    "expected_files": ["src/script/sigcache.cpp", "src/validation.cpp", "src/txmempool.cpp"],
    "expected_concepts": ["CachingTransactionSignatureChecker", "ResetSigCache", "reorg", "DisconnectBlock"],
    "success_criteria": "Found cache implementation, usage sites, and invalidation logic"
  },

  "scenario_5_simple_edit": {
    "name": "Simple Single-File Edit",
    "difficulty": "easy",
    "type": "edit",
    "prompt": "Change the COINBASE_MATURITY constant from 100 blocks to 150 blocks in the Bitcoin codebase. Update the constant definition and any related comments that mention the specific value.",
    "expected_files": ["src/consensus/consensus.h"],
    "expected_edits": 1,
    "validation": "grep -n '150' src/consensus/consensus.h | grep COINBASE_MATURITY",
    "success_criteria": "Constant changed to 150, comments updated"
  },

  "scenario_6_multi_location_refactor": {
    "name": "Multi-Location Refactor",
    "difficulty": "medium",
    "type": "edit",
    "prompt": "Rename the function CheckInputScripts to ValidateInputScripts everywhere in the codebase. Make sure to update the declaration, definition, all call sites, and any comments that reference it by name.",
    "expected_files": ["src/validation.cpp", "src/validation.h", "src/txmempool.cpp"],
    "expected_edits": 15,
    "validation": "grep -r 'ValidateInputScripts' src/ && ! grep -r 'CheckInputScripts' src/",
    "success_criteria": "All instances renamed, no missed locations, code compiles"
  },

  "scenario_7_logic_change": {
    "name": "Logic Change - Fee Policy",
    "difficulty": "hard",
    "type": "edit",
    "prompt": "Modify the Bitcoin transaction relay policy to reject transactions with a fee rate below 5 sat/vB instead of the current 1 sat/vB minimum. Update the constant definition, the validation logic that uses it, and any error messages that reference the specific value.",
    "expected_files": ["src/policy/policy.h", "src/validation.cpp", "src/node/transaction.cpp"],
    "expected_edits": 5,
    "validation": "grep -r '5.*sat.*vB' src/policy/ && grep -r 'DUST_RELAY_TX_FEE' src/",
    "success_criteria": "Constant updated, all validation checks use new value, error messages updated"
  },

  "scenario_8_new_feature": {
    "name": "Add New Feature - RPC Parameter",
    "difficulty": "very_hard",
    "type": "edit",
    "prompt": "Add a new optional RPC parameter called 'max_fee_rate' to the sendrawtransaction RPC endpoint. This parameter should reject the transaction if its fee rate exceeds the specified maximum (in sat/vB). Add the parameter to the RPC definition, implement the validation logic, add appropriate error handling that returns a clear error message, and update the RPC help text to document the new parameter.",
    "expected_files": ["src/rpc/rawtransaction.cpp", "src/node/transaction.cpp"],
    "expected_edits": 8,
    "validation": "grep -A5 'max_fee_rate' src/rpc/rawtransaction.cpp",
    "success_criteria": "Parameter added, validation implemented, error handling works, help text updated, follows existing RPC patterns"
  }
}
